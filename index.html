<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Validatar by yahoo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Validatar</h1>
      <h2 class="project-tagline">Functional testing framework for Big Data pipelines</h2>
      <a href="https://github.com/yahoo/validatar" class="btn">View on GitHub</a>
      <a href="https://github.com/yahoo/validatar/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/yahoo/validatar/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="validatar" class="anchor" href="#validatar" aria-hidden="true"><span class="octicon octicon-link"></span></a>Validatar</h1>

<p><a href="https://travis-ci.org/yahoo/validatar"><img src="https://travis-ci.org/yahoo/validatar.svg?branch=master" alt="Build Status"></a> <a href="https://coveralls.io/r/yahoo/validatar?branch=master"><img src="https://coveralls.io/repos/yahoo/validatar/badge.svg?branch=master" alt="Coverage Status"></a> <a href="https://bintray.com/yahoo/maven/validatar/_latestVersion"><img src="https://api.bintray.com/packages/yahoo/maven/validatar/images/download.svg" alt="Download"></a></p>

<p>Functional testing framework for Big Data pipelines. Currently support querying pipeline results through Hive (HiveServer2) and Pig (PigServer).</p>

<p>Validatar is currently compiled against <em>Pig-0.14</em>. Running against an older or newer version may result in issues if interfaces have changed. These are relatively minor from experience and can be fixed with relatively minor fixes to engine code.</p>

<h2>
<a id="how-to-build-validatar" class="anchor" href="#how-to-build-validatar" aria-hidden="true"><span class="octicon octicon-link"></span></a>How to build Validatar</h2>

<p>You need maven/JDK to build Validatar.</p>

<p>Run:</p>

<pre><code>make jar
</code></pre>

<h2>
<a id="how-to-run" class="anchor" href="#how-to-run" aria-hidden="true"><span class="octicon octicon-link"></span></a>How to run</h2>

<p>Use hadoop jar validatar-jar-with-dependencies.jar com.yahoo.validatar.App --help (or -h) for Help</p>

<h3>
<a id="to-run-hive-tests-in-validatar" class="anchor" href="#to-run-hive-tests-in-validatar" aria-hidden="true"><span class="octicon octicon-link"></span></a>To run Hive tests in Validatar:</h3>

<pre><code>export HADOOP_CLASSPATH="$HADOOP_CLASSPATH:/path/to/hive/jdbc/lib/jars/*"
hadoop jar validatar-jar-with-dependencies.jar com.yahoo.validatar.App -s tests/ --report report.xml --hive-jdbc ...
</code></pre>

<p>Hive needs the JDBC uri of HiveServer2. Note that the DB is in the URI. Do not add it if your queries use</p>

<pre><code>... FROM DB.TABLE WHERE ...

--hive-jdbc "jdbc:hive2://&lt;URI&gt;/&lt;DB&gt;;&lt;Optional params: E.g. sasl.qop=auth;principal=hive/&lt;PRINCIPAL_URL&gt; etc&gt;
</code></pre>

<h3>
<a id="to-run-pig-tests-in-validatar" class="anchor" href="#to-run-pig-tests-in-validatar" aria-hidden="true"><span class="octicon octicon-link"></span></a>To run Pig tests in Validatar:</h3>

<pre><code>export HADOOP_CLASSPATH="$HADOOP_CLASSPATH:/path/to/pig/lib/*" (Add other jars here depending on your pig exec type or if hive/hcat is used in Pig)
hadoop jar validatar-jar-with-dependencies.jar com.yahoo.validatar.App -s tests/ --report report.xml --pig-exec-type mr --pig-setting 'mapreduce.job.acl-view-job=*' ...
</code></pre>

<p>Pig parameters are not supported in the pig query. Instead, use our parameter substitution (see below).</p>

<h2>
<a id="writing-tests" class="anchor" href="#writing-tests" aria-hidden="true"><span class="octicon octicon-link"></span></a>Writing Tests</h2>

<h3>
<a id="test-file-format" class="anchor" href="#test-file-format" aria-hidden="true"><span class="octicon octicon-link"></span></a>Test file format</h3>

<p>Test files are written in the YAML format. See example in src/test/resources/. The schema is as follows:</p>

<pre><code>name: Test family name : String
description: Test family description : String
queries:
   - name: Query name : String : Ex "Analytics"
     engine: Execution engine : String Ex "hive" or "pig"
     value: Query : String : Ex "SELECT COUNT(*) AS pv_count FROM page_data"
   ...
tests:
   - name: Test name : String
     description: Test description : String
     asserts:
        - Assertion on some query. Query name is prefixed to the value. : Ex Analytics.pv_count &gt; 10000
   ...
</code></pre>

<p>Queries are named, this name is used as a namespace for all the values returned from the query. In the above example, we created a query named "Analytics". It stores the return value "pv_count". We are then able to use this in our later asserts.</p>

<p>Validatar can run a single test file or a folder of test files. Use the --help option to see more details.</p>

<h3>
<a id="assertions" class="anchor" href="#assertions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Assertions</h3>

<p>Assertions are quite flexible, allowing for the following operations:</p>

<pre><code>                   &gt;  : greater than
                   &gt;= : greater or equal to
                   &lt;  : less than
                   &lt;= : less or equal to
                   == : equal to
                   != : not equal to
                   +  : add
                   -  : subtract
                   *  : multiply
                   /  : divide
                   &amp;&amp; : boolean and
                   || : boolean or
approx(a, b, percent) : true if a and b within percent difference (0.0 to 1.0) of each other.
</code></pre>

<h3>
<a id="parameter-substitution" class="anchor" href="#parameter-substitution" aria-hidden="true"><span class="octicon octicon-link"></span></a>Parameter Substitution</h3>

<p>You may want queries that use a specific date column, or similar changing parameter. For this, we have a parameter substation feature.</p>

<p>Simply pass <code>--parameter KEY=VALUE</code> in the CLI and the <code>KEY</code> will be replaced with <code>VALUE</code> in all queries. For example, to query June 23rd 2015, you could use <code>--parameter DATE=2015-06-23</code>. If the query uses <code>${DATE}</code> in the query it will be replaced before execution with <code>2015-06-23</code>.</p>

<h2>
<a id="changelog" class="anchor" href="#changelog" aria-hidden="true"><span class="octicon octicon-link"></span></a>Changelog</h2>

<table>
<thead>
<tr>
<th>Version</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>0.1.4</td>
<td>Initial release with Hive</td>
</tr>
<tr>
<td>0.1.5</td>
<td>Typesystem, metadata support</td>
</tr>
<tr>
<td>0.1.6</td>
<td>No feature release. Source and Javadoc bundled in artifact</td>
</tr>
<tr>
<td>0.1.7</td>
<td>Multiple Hive databases across Queries</td>
</tr>
<tr>
<td>0.1.8</td>
<td>Null types in Hive results fix</td>
</tr>
<tr>
<td>0.1.9</td>
<td>Empty results handling bug fix</td>
</tr>
<tr>
<td>0.2.0</td>
<td>Internal switch to Java 8. hive-queue is no longer a setting. Use hive-setting.</td>
</tr>
<tr>
<td>0.3.0</td>
<td>Pig support added.</td>
</tr>
</tbody>
</table>

<h2>
<a id="members" class="anchor" href="#members" aria-hidden="true"><span class="octicon octicon-link"></span></a>Members</h2>

<p>Akshai Sarma, <a href="mailto:akshaisarma@gmail.com">akshaisarma@gmail.com</a>
Josh Walters, <a href="mailto:josh@joshwalters.com">josh@joshwalters.com</a></p>

<h2>
<a id="contributors" class="anchor" href="#contributors" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contributors</h2>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/yahoo/validatar">Validatar</a> is maintained by <a href="https://github.com/yahoo">yahoo</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
